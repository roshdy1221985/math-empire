<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø¨ÙˆØ§Ø¨Ø© ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø± | Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ±ÙŠØ© Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&family=Amiri:wght@700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #040d21;
            --gold: #d4af37;
            --gold-grad: linear-gradient(45deg, #bf953f, #fcf6ba, #b38728, #fbf5b7, #aa771c);
            --glass: rgba(255, 255, 255, 0.05);
            --border: rgba(212, 175, 55, 0.3);
        }

        body {
            margin: 0; font-family: 'Cairo', sans-serif;
            background: radial-gradient(circle at top, #1a1a2e 0%, #040d21 100%);
            color: #fff; min-height: 100vh; display: flex; flex-direction: column;
            align-items: center; padding: 20px; box-sizing: border-box;
        }

        /* --- ØªØ­ØµÙŠÙ†Ø§Øª Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© --- */
        @media print {
            body { background: white !important; color: black !important; padding: 0; }
            .no-print { display: none !important; }
            .card { border: 1px solid #000 !important; background: none !important; box-shadow: none !important; }
            th { background: #eee !important; color: #000 !important; border-bottom: 2px solid #000 !important; }
            td { border-bottom: 1px solid #ccc !important; color: #000 !important; }
            .gold-text { color: black !important; }
        }

        .header-container {
            text-align: center; margin-bottom: 40px; margin-top: 20px;
        }
        .header-container h1 {
            font-family: 'Amiri'; color: var(--gold); font-size: 3rem; margin: 0;
            text-shadow: 0 0 20px rgba(212, 175, 55, 0.4);
        }

        .card {
            background: var(--glass); border: 1px solid var(--border);
            border-radius: 25px; padding: 40px; width: 100%; max-width: 800px;
            backdrop-filter: blur(15px); box-shadow: 0 15px 35px rgba(0,0,0,0.5);
            margin-bottom: 30px; box-sizing: border-box;
        }

        .search-box {
            display: flex; gap: 15px; width: 100%;
        }
        .search-input {
            flex: 1; padding: 18px; border-radius: 15px; border: 2px solid var(--gold);
            background: rgba(0,0,0,0.5); color: #fff; font-family: 'Cairo';
            font-size: 1.2rem; outline: none; transition: 0.3s;
        }
        .search-input:focus { box-shadow: 0 0 15px rgba(212, 175, 55, 0.5); }
        
        .btn-gold {
            background: var(--gold-grad); color: #000; border: none; padding: 18px 30px;
            border-radius: 15px; font-weight: 900; cursor: pointer; font-size: 1.2rem;
            font-family: 'Cairo'; transition: 0.3s;
        }
        .btn-gold:hover { transform: scale(1.05); }

        .gold-text { color: var(--gold); font-family: 'Amiri'; }

        /* --- Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ÙˆØ§Ù„Ø¬Ø¯Ø§ÙˆÙ„ --- */
        #results-container { display: none; width: 100%; max-width: 800px; }
        
        .student-info-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px; margin-bottom: 30px; text-align: center;
        }
        .info-box {
            background: rgba(0,0,0,0.4); padding: 20px; border-radius: 15px;
            border: 1px solid var(--border);
        }
        .info-box span { display: block; opacity: 0.7; margin-bottom: 5px; font-size: 0.9rem; }
        .info-box strong { color: var(--gold); font-size: 1.5rem; }

        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th { background: rgba(212,175,55,0.1); color: var(--gold); padding: 15px; text-align: right; font-weight: bold; border-bottom: 2px solid var(--gold); }
        td { padding: 15px; border-bottom: 1px solid rgba(255,255,255,0.05); }
        tr:hover td { background: rgba(255,255,255,0.02); }

        .status-badge {
            padding: 5px 12px; border-radius: 10px; font-size: 0.9rem; font-weight: bold;
        }
        .badge-excellent { background: rgba(40, 167, 69, 0.2); color: #28a745; border: 1px solid #28a745; }
        .badge-good { background: rgba(255, 193, 7, 0.2); color: #ffc107; border: 1px solid #ffc107; }
        .badge-needs-work { background: rgba(220, 53, 69, 0.2); color: #dc3545; border: 1px solid #dc3545; }

        /* Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ */
        #loader {
            display: none; text-align: center; margin: 20px 0; color: var(--gold);
            font-weight: bold; font-size: 1.2rem; animation: pulse 1s infinite;
        }
        @keyframes pulse { 0% { opacity: 0.5; } 50% { opacity: 1; } 100% { opacity: 0.5; } }

        @media screen and (max-width: 600px) {
            .search-box { flex-direction: column; }
            .header-container h1 { font-size: 2.2rem; }
        }
    </style>
</head>
<body>

    <div class="header-container no-print">
        <div style="font-size: 3rem; margin-bottom: 10px;">ğŸ›¡ï¸</div>
        <h1>Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø¯ÙŠÙˆØ§Ù† Ø§Ù„Ù…Ù„ÙƒÙŠ Ù„Ø£ÙˆÙ„ÙŠØ§Ø¡ Ø§Ù„Ø£Ù…ÙˆØ±</h1>
        <p style="opacity: 0.8; font-size: 1.2rem;">Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ±ÙŠØ© Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª - Ø§Ù„Ø£Ø³ØªØ§Ø° Ø±Ø´Ø¯ÙŠ Ø³ÙŠØ¯</p>
    </div>

    <div class="card no-print">
        <label style="color:var(--gold); font-weight:bold; display:block; margin-bottom:15px; font-size:1.1rem;">ğŸ” Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø¨Ø·Ù„ (Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ):</label>
        <div class="search-box">
            <input type="text" id="search-input" class="search-input" placeholder="Ù…Ø«Ø§Ù„: Ù…Ø­Ù…Ø¯ Ø±Ø´Ø¯ÙŠ Ø³ÙŠØ¯" onkeypress="handleEnter(event)">
            <button class="btn-gold" onclick="searchStudent()">Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø³Ø¬Ù„Ø§Øª ğŸ“œ</button>
        </div>
        <div id="loader">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ±ÙŠØ©... â³</div>
        <div id="error-msg" style="color:#ff5e5e; text-align:center; margin-top:15px; font-weight:bold; display:none;"></div>
    </div>

    <div id="results-container">
        <div class="card" style="border-color: var(--gold);">
            <div style="display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid var(--border); padding-bottom:20px; margin-bottom:20px;">
                <h2 class="gold-text" style="margin:0;">ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ</h2>
                <button class="btn-gold no-print" style="padding: 10px 20px; font-size: 1rem;" onclick="window.print()">Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ± ğŸ–¨ï¸</button>
            </div>

            <div class="student-info-grid">
                <div class="info-box">
                    <span>Ø§Ø³Ù… Ø§Ù„Ø¨Ø·Ù„</span>
                    <strong id="res-name">--</strong>
                </div>
                <div class="info-box">
                    <span>Ø§Ù„Ù…Ø¯Ø±Ø³Ø©</span>
                    <strong id="res-school">--</strong>
                </div>
                <div class="info-box" style="background: rgba(212,175,55,0.1); border-color: var(--gold);">
                    <span>Ø§Ù„Ø±ØªØ¨Ø© Ø§Ù„Ù…Ù„ÙƒÙŠØ©</span>
                    <strong id="res-rank">--</strong>
                </div>
                <div class="info-box">
                    <span>Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù†Ù‚Ø§Ø· (XP)</span>
                    <strong id="res-xp" style="font-family:'Amiri';">--</strong>
                </div>
            </div>

            <h3 class="gold-text" style="margin-top:40px; border-bottom:2px dashed var(--border); padding-bottom:10px;">ğŸ“Š ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª ÙˆØ§Ù„ØªØ­Ø¯ÙŠØ§Øª</h3>
            <div style="overflow-x: auto;">
                <table>
                    <thead>
                        <tr>
                            <th>Ø§Ù„Ø¯Ø±Ø³ / Ø§Ù„ØªØ­Ø¯ÙŠ</th>
                            <th>Ø§Ù„Ø¯Ø±Ø¬Ø©</th>
                            <th>Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</th>
                            <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²</th>
                        </tr>
                    </thead>
                    <tbody id="history-table-body">
                        </tbody>
                </table>
            </div>
        </div>
    </div>

<script>
    const API_URL = "http://192.168.100.5:8000"; // âš ï¸ ØªØ°ÙƒØ± Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¶Ø¹ Ø§Ù„Ù€ IP Ø§Ù„Ø®Ø§Øµ Ø¨Ø¬Ù‡Ø§Ø²Ùƒ Ù‡Ù†Ø§!

    function handleEnter(e) {
        if (e.key === "Enter") searchStudent();
    }

    function getRankTitle(xp) {
        if (xp >= 3000) return "ğŸ‘‘ Ø³Ù„Ø·Ø§Ù† Ø§Ù„Ø£Ø±Ù‚Ø§Ù…";
        if (xp >= 1500) return "ğŸ§™â€â™‚ï¸ Ø§Ù„ÙˆØ²ÙŠØ± Ø§Ù„Ø­ÙƒÙŠÙ…";
        if (xp >= 500) return "âš”ï¸ ÙØ§Ø±Ø³ Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª";
        if (xp >= 100) return "ğŸ›¡ï¸ Ø¬Ù†Ø¯ÙŠ Ø´Ø¬Ø§Ø¹";
        return "Ù…Ø³ØªÙƒØ´Ù Ø¬Ø¯ÙŠØ¯";
    }

    function getStatusBadge(score, total) {
        const percentage = (score / total) * 100;
        if(percentage >= 90) return `<span class="status-badge badge-excellent">Ù…Ù…ØªØ§Ø² âœ¨</span>`;
        if(percentage >= 70) return `<span class="status-badge badge-good">Ø¬ÙŠØ¯ Ø¬Ø¯Ø§Ù‹ ğŸ‘</span>`;
        return `<span class="status-badge badge-needs-work">ÙŠØ­ØªØ§Ø¬ ØªØ¯Ø±ÙŠØ¨ ğŸ“š</span>`;
    }

    // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªØ§Ø±ÙŠØ® Ù„ÙŠØµØ¨Ø­ Ù…Ù‚Ø±ÙˆØ¡Ø§Ù‹ Ø¨Ø´ÙƒÙ„ Ø¬Ù…ÙŠÙ„
    function formatDate(dateString) {
        const options = { year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute:'2-digit' };
        return new Date(dateString).toLocaleDateString('ar-EG', options);
    }

    async function searchStudent() {
        const nameInput = document.getElementById('search-input').value.trim();
        const errorMsg = document.getElementById('error-msg');
        const loader = document.getElementById('loader');
        const resultsContainer = document.getElementById('results-container');

        if (!nameInput) {
            errorMsg.innerText = "âš ï¸ ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨ Ø£ÙˆÙ„Ø§Ù‹!";
            errorMsg.style.display = "block";
            return;
        }

        errorMsg.style.display = "none";
        resultsContainer.style.display = "none";
        loader.style.display = "block";

        try {
            const safeName = encodeURIComponent(nameInput);
            const res = await fetch(`${API_URL}/api/parent/search/${safeName}`);
            const data = await res.json();

            loader.style.display = "none";

            if (data.found) {
                // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
                document.getElementById('res-name').innerText = data.student.full_name;
                document.getElementById('res-school').innerText = data.student.school_name || "Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ø´ÙŠØ® Ø³Ø¹ÙŠØ¯ Ø¨Ù† Ø£Ø­Ù…Ø¯";
                document.getElementById('res-xp').innerText = data.total_xp + " XP";
                document.getElementById('res-rank').innerText = getRankTitle(data.total_xp);

                // ØªØ¹Ø¨Ø¦Ø© Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªØ§Ø±ÙŠØ®
                const tbody = document.getElementById('history-table-body');
                if (data.history && data.history.length > 0) {
                    tbody.innerHTML = data.history.map(test => `
                        <tr>
                            <td style="font-weight:bold;">${test.lesson}</td>
                            <td style="font-family:'Amiri'; font-size:1.2rem; font-weight:bold;">${test.score} / ${test.total}</td>
                            <td>${getStatusBadge(test.score, test.total)}</td>
                            <td style="direction:ltr; text-align:right; opacity:0.8; font-size:0.9rem;">${formatDate(test.timestamp)}</td>
                        </tr>
                    `).join('');
                } else {
                    tbody.innerHTML = `<tr><td colspan="4" style="text-align:center; opacity:0.6; padding:30px;">Ù„Ù… ÙŠÙ‚Ù… Ø§Ù„Ø¨Ø·Ù„ Ø¨Ø¥Ø¬Ø±Ø§Ø¡ Ø£ÙŠ Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†.</td></tr>`;
                }

                resultsContainer.style.display = "block";
            } else {
                errorMsg.innerHTML = "âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø·Ø§Ù„Ø¨ Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø§Ø³Ù… ÙÙŠ Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ±ÙŠØ©.<br><small>ØªØ£ÙƒØ¯ Ù…Ù† ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø§Ø³Ù… Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­ ÙƒÙ…Ø§ Ø³Ø¬Ù„Ù‡ Ø§Ù„Ø·Ø§Ù„Ø¨.</small>";
                errorMsg.style.display = "block";
            }
        } catch (error) {
            loader.style.display = "none";
            errorMsg.innerText = "âš ï¸ ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª. ØªØ£ÙƒØ¯ Ù…Ù† ØªØ´ØºÙŠÙ„ Ø§Ù„Ø®Ø§Ø¯Ù… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ!";
            errorMsg.style.display = "block";
        }
    }
</script>
</body>
</html>